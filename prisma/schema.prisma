// CryptoTrader Pro - Trading App Database Schema

generator client {
  provider        = "prisma-client-js"
  driverAdapters  = true
}

datasource db {
  provider  = "sqlite"
  url       = env("TURSO_DATABASE_URL")
  directUrl = env("TURSO_DATABASE_URL")
}

// API Configuration (encrypted keys)
model ApiConfig {
  id              String   @id @default(cuid())
  name            String   @unique  // "binance", "binance_testnet"
  apiKey          String?           // Encrypted
  apiSecret       String?           // Encrypted
  isActive        Boolean  @default(false)
  testnet         Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// User Settings
model UserSettings {
  id                    String   @id @default(cuid())
  paperBalance          Float    @default(10000)
  realBalance           Float    @default(0)
  preferredCurrency     String   @default("USDT")
  theme                 String   @default("dark")
  notificationsEnabled  Boolean  @default(true)
  alertSoundEnabled     Boolean  @default(true)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

// Open Positions
model Position {
  id            String   @id @default(cuid())
  symbol        String
  type          String   // "BUY"
  amount        Float
  entryPrice    Float
  currentPrice  Float
  pnl           Float    @default(0)
  pnlPercent    Float    @default(0)
  isPaper       Boolean  @default(true)
  stopLoss      Float?
  takeProfit    Float?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([symbol])
  @@index([isPaper])
}

// Transactions History
model Transaction {
  id          String   @id @default(cuid())
  symbol      String
  type        String   // "BUY" or "SELL"
  amount      Float
  price       Float
  total       Float
  fee         Float    @default(0)
  isPaper     Boolean  @default(true)
  orderId     String?  // Binance order ID for real trades
  status      String   @default("completed") // pending, completed, failed, cancelled
  createdAt   DateTime @default(now())

  @@index([symbol])
  @@index([isPaper])
  @@index([createdAt])
}

// Price Alerts
model PriceAlert {
  id          String   @id @default(cuid())
  symbol      String
  targetPrice Float
  condition   String   // "above" or "below"
  message     String?
  isActive    Boolean  @default(true)
  triggered   Boolean  @default(false)
  triggeredAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([symbol])
  @@index([isActive])
}

// Pending Orders (Limit, Stop-Loss)
model PendingOrder {
  id            String   @id @default(cuid())
  symbol        String
  type          String   // "BUY" or "SELL"
  orderType     String   // "LIMIT", "STOP_LOSS", "TAKE_PROFIT"
  amount        Float
  price         Float
  triggerPrice  Float?
  isPaper       Boolean  @default(true)
  status        String   @default("pending") // pending, executed, cancelled
  executedAt    DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([symbol])
  @@index([status])
}

// Candlestick Data Cache
model CandleCache {
  id          String   @id @default(cuid())
  symbol      String
  interval    String   // "1m", "5m", "15m", "1h", "4h", "1d"
  data        String   // JSON array of candles
  lastUpdate  DateTime @default(now())

  @@unique([symbol, interval])
}

// Watchlist
model Watchlist {
  id        String   @id @default(cuid())
  symbol    String
  order     Int      @default(0)
  createdAt DateTime @default(now())

  @@unique([symbol])
}
